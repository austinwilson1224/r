---
title: Analyzing Simulations
date: 4 October 2020
---

#### Outcomes

- Visualize and compare complex data
- Use higher order functions
- Explain unfamiliar code written by another person


#### Background

As promised, in this assignment we will use the functions representing random variables that we developed in the previous assignment to explore different strategies for playing the game of roulette.

#### Instructions

- Don't be constrained by the questions.
    If you want to ask something deeper, then go for it!
- Answer the following questions, and show all your R code.
- Upload your submission to Canvas in nicely formatted HTML generated from Rstudio.

Below are some functions and code you can use to complete the assignment.

```{r, echo = FALSE}
even = function(x)
{
    win = (x %% 2 == 0) & (x != 0)
    ifelse(win, 1, -1)
}


high = function(x)
{
    win = (18 < x) & (x != 0)
    ifelse(win, 1, -1)
}


column1 = function(x)
{
    ifelse(x %% 3 == 1, 2, -1)
}


straightup = function(x, d = 1)
{
    ifelse(x == d, 35, -1)
}


# Construct a simple betting strategy
simple_strategy = function(bet = even)
{
    function(x) cumsum(bet(x))
}


#' Simulate plays from a betting strategy
#'
#' @param strategy
#' @param nplayers number of players to use this strategy
#' @param ntimes number of times each player should play
play = function(strategy = simple_strategy()
    , nplayers = 100L
    , ntimes = 1000L
    , ballvalues = 0:36
){
    replicate(nplayers, strategy(sample(ballvalues, size = ntimes, replace = TRUE)))
}
```


# win then walk away strategy

```{r}
win_walk = function(bet = even) {
    0
}
```



# Questions

## 1 - Simple strategies

> Create at least one visualization for at least one of the betting strategies above.
> For example, we can simulate how much a single player wins at each time if she sits down and plays 20 games, always betting one unit of money on even, as follows.

```{r, echo = FALSE}
library(ggplot2)
theme_set(theme_bw())  # Feel free to set different themes

set.seed(893) # Starts the random number generator at a particular place, so the graph will look the same for everyone.
ntimes = 200
d = data.frame(time = seq(ntimes))
s = simple_strategy(column1)
d$winnings = play(s, nplayers = 1, ntimes = ntimes)

g = ggplot() + labs(title = "Single game of roulette", caption = "Simulated winnings over time for a single roulette player betting one dollar on evens every time.")
g = g + geom_line(aes(time, winnings), data = d)
print(g)
```

# 1 There are my results using 2000 bets and 12 different players using straightup strategy

```{r}
library(ggplot2)
theme_set(theme_bw())  # Feel free to set different themes

set.seed(42)
ntimes = 2000
d = data.frame(time = seq(ntimes))
s = simple_strategy(straightup)

# val = 0
# test_name = 'winnings' + str(val)
# val = str(0)
# val
# val = 0
# test = paste(c("winnings",val), collapse="")
# test
d$winnings = play(s, nplayers = 1, ntimes = ntimes)
g = ggplot() + labs(title = "Single game of roulette", caption = "Simulated winnings over time for a single roulette player betting one dollar on evens every time.")

average = d$winnings
# average
for(i in 0:100) {
    set.seed(i)
    ntimes = 2000
    d = data.frame(time = seq(ntimes))
    s = simple_strategy(straightup)
    column_name = paste(c("winnings",i), collapse="")
    d$winnings = play(s, nplayers = 1, ntimes = ntimes)
    average = average + d$winnings
    g = g + geom_line(aes(time, winnings), data = d, alpha=.4)
    # print(g)
}

average = average / 12
plot(average, type = "l")
# g = g + abline(a = average[1], b = average[-1])
# g = g + line()

# View(d)

print(g)
```




> One fun visualization is to draw many partially overlapping opaque lines, with each line representing a sequence of winnings by a single player.
> You can also add:
> 
> - A line for the expected value of winnings at each point in time
> - A line for the actual simulated average won by each player at each point in time
> - Labeled vertical and horizontal lines representing typical player behavior, or casino betting limits.
> 
> Comment on your visualization(s).
> What does it show? My visualization shows the winnings for 12 different players and 2000 bets
> What questions does it answer? This doesn't anwser any questions, but we can see the trend in winnings

```{r}
# TODO create visualization(s)
# not betting strategy
not_bet = function(x) rep(0, length(x))
```

TODO explain visualization(s)


## 1 - Martingale strategy

> The simplest [martingale strategy](https://en.wikipedia.org/wiki/Martingale_(betting_system)) for betting on a game with nearly equal chances of win and loss is to start with the minimum bet, and then double your previous bet every time you lose.
> If you win, then you again start fresh by betting the minimum amount.
> It's possible to use this strategy in roulette, but what will happen?

- Since the bets are growing exponentially, you will eventually go bankrupt using this strategy. You need infinite wealth to recoup all losses. The expected value is zero. 


```{r}
doublebet = function(x, initialbet = 1, strategy = even)
{
    winnings = rep(NA, length(x))
    betsize = initialbet
    current_winnings = 0
    for(i in seq_along(x)){
        if(strategy(x[i]) == 1){
            current_winnings = current_winnings + betsize
            betsize = initialbet
        } else {
            current_winnings = current_winnings - betsize
            betsize = 2 * betsize
        }
        winnings[i] = current_winnings
    }
    winnings
}
```

> `doublebet` implements the basic martingale doubling strategy (very inefficiently ðŸ˜¬, but that's fine for now).
> Describe in detail what this function does, and how you believe it works.

- 

> What are the arguments?

- The arguments are x which is a vector of values to that the ball lands on. Initial bet has the default value of 1. This is the initial amount of money bet on the first value in x. Strategy is the betting strategy that will be used. This is being passed a function, the default value is even. This is the strategy of betting that will be used. 

> What kind of objects makes sense to pass in as arguments?

- x should be a vector of values that will be the winning number. These values should be between 0 and 36. They should be randomly selected because this is a game of chance. 

- Initial bet should be whatever you want to start out betting at. I think 1 makes sense. Maybe you're feeling lucky and start out betting $100. 

- Strategy should be passed a function which dictates how the gambler will attempt to win. 

> TODO: explain `doublebet`. 

- Double bet takes in a vector of values that the table will roll (x), an initial bet and a strategy. It creates a winnings vector the same length of x to store all the money won (or lost) usint the betting strategy. The function then loops through all the values in x. It passes each value in x to the betting strategy function (even) and checks if the x value was a winning value (the case where strategy returns 1). If the bet won then betsize is reset to initialbet (the minimum value). If the x value was a losing value then the betsize is doubled. 


## 3 - Analyzing the martingale strategy

> We can simulate from the martingale strategy as follows.

```{r, echo = FALSE}

for(i in 0:5) {
    set.seed(i)
    ntimes = 30
    m = data.frame(time = seq(ntimes))
    m$winnings = play(doublebet, nplayers = 1, ntimes = ntimes)

    g = ggplot() + labs(title = "The Martingale Strategy in Roulette", caption = "Simulated winnings over time for     a single roulette player following the basic martingale betting strategy.")
    g = g + geom_line(aes(time, winnings), data = m)
    # print(g)
    
}
print(g)
# ntimes = 30
# m = data.frame(time = seq(ntimes))
# m$winnings = play(doublebet, nplayers = 1, ntimes = ntimes)
# 
# g = ggplot() + labs(title = "The Martingale Strategy in Roulette", caption = "Simulated winnings over time for a single roulette player following the basic martingale betting strategy.")
# g = g + geom_line(aes(time, winnings), data = m)
# print(g)
```

> Simulate and investigate different scenarios to create at least one visualization of the martingale strategy.
> Comment on your visualization(s) and address the following.
>
> 1. Under what assumptions does the martingale strategy work in theory?

- The martingale strategy works, in theory, when the gambler has infinite wealth and the odds are 50/50. 

> 2. Could the martingale strategy work in practice, given table limits?

- Yes. As long as you have enough money to keep doubling your bet when you lose.

> 3. Is it good or bad for casinos if players use the martingale strategy?
>       Does it depend on whether the casino is large or small?

- I would say it is good. The odds are always slightly in the casinos favor because half the numbers are even, half are odd but 0 is neither and the house wins. The only plays that can use martingale have near 50/50 odds. But not exactly. 


```{r}
# TODO create visualization(s)
```

TODO explain visualization(s)


## 4 - Advising a friend

> Suppose someone you care about is going to visit Las Vegas, and is enthusiastic about the martingale strategy, but they have no background in math and logic.
> Explain to this person, in simple terms, what the best strategy is for them to play roulette and why.

- The best strategy is to not go at all. The expected value of the margingale strategy is zero. Why waste you time gambling if you can expect to make nothing in the long run?
